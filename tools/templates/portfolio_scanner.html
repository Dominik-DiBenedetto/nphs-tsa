<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>PDF Scanner & Grader</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                    Roboto, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                padding: 20px;
            }

            .container {
                max-width: 800px;
                margin: 0 auto;
                background: white;
                border-radius: 16px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                overflow: hidden;
            }

            .header {
                background: #2d3748;
                color: white;
                padding: 30px;
                text-align: center;
            }

            .header h1 {
                font-size: 2.5rem;
                margin-bottom: 10px;
                font-weight: 700;
            }

            .header p {
                opacity: 0.8;
                font-size: 1.1rem;
            }

            .upload-section {
                padding: 40px;
                text-align: center;
            }

            .upload-area {
                border: 3px dashed #cbd5e0;
                border-radius: 12px;
                padding: 60px 20px;
                transition: all 0.3s ease;
                cursor: pointer;
                background: #f7fafc;
            }

            .upload-area:hover {
                border-color: #667eea;
                background: #edf2f7;
            }

            .upload-area.dragover {
                border-color: #667eea;
                background: #e6fffa;
            }

            .upload-icon {
                font-size: 4rem;
                color: #a0aec0;
                margin-bottom: 20px;
            }

            .upload-text {
                font-size: 1.2rem;
                color: #4a5568;
                margin-bottom: 10px;
            }

            .upload-subtext {
                color: #718096;
                font-size: 0.9rem;
            }

            #fileInput, #cegInput {
                display: none;
            }

            .btn {
                background: #667eea;
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                font-size: 1rem;
                cursor: pointer;
                transition: background 0.3s ease;
                margin-top: 20px;
            }

            .btn:hover {
                background: #5a67d8;
            }

            .btn:disabled {
                background: #a0aec0;
                cursor: not-allowed;
            }

            .processing {
                display: none;
                padding: 40px;
                text-align: center;
            }

            .spinner {
                width: 50px;
                height: 50px;
                border: 4px solid #e2e8f0;
                border-top: 4px solid #667eea;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin: 0 auto 20px;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .report-section {
                display: none;
                padding: 40px;
            }

            .report-header {
                text-align: center;
                margin-bottom: 30px;
            }

            .grade-circle {
                width: 120px;
                height: 120px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 20px;
                font-size: 2.5rem;
                font-weight: bold;
                color: white;
            }

            .grade-a {
                background: #48bb78;
            }
            .grade-b {
                background: #38b2ac;
            }
            .grade-c {
                background: #ed8936;
            }
            .grade-d {
                background: #f56565;
            }
            .grade-f {
                background: #e53e3e;
            }

            .metrics {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin: 30px 0;
            }

            .metric-card {
                background: #f7fafc;
                padding: 20px;
                border-radius: 8px;
                text-align: center;
            }

            .metric-value {
                font-size: 2rem;
                font-weight: bold;
                color: #2d3748;
                margin-bottom: 5px;
            }

            .metric-label {
                color: #718096;
                font-size: 0.9rem;
            }

            .issues-section {
                margin-top: 30px;
            }

            .issue-item {
                background: #fed7d7;
                border-left: 4px solid #f56565;
                padding: 15px;
                margin-bottom: 10px;
                border-radius: 0 8px 8px 0;
            }

            .issue-title {
                font-weight: bold;
                color: #c53030;
                margin-bottom: 5px;
            }

            .issue-description {
                color: #742a2a;
                font-size: 0.9rem;
            }

            .suggestions-section {
                margin-top: 30px;
            }

            .suggestion-item {
                background: #c6f6d5;
                border-left: 4px solid #48bb78;
                padding: 15px;
                margin-bottom: 10px;
                border-radius: 0 8px 8px 0;
            }

            .suggestion-title {
                font-weight: bold;
                color: #2f855a;
                margin-bottom: 5px;
            }

            .suggestion-description {
                color: #276749;
                font-size: 0.9rem;
            }

            .reset-btn {
                background: #718096;
                margin-top: 30px;
            }

            .reset-btn:hover {
                background: #4a5568;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>üìÑ PDF Scanner & Grader</h1>
                <p>
                    Upload your PDF documents for intelligent analysis and
                    grading
                </p>
            </div>

            <div id="uploadSection" class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">
                        Drop your Portfolio file here or click to browse
                    </div>
                    <div class="upload-subtext">
                        Supports PDF files up to 10MB
                    </div>
                    <input type="file" id="fileInput" accept=".pdf" />
                    <button
                        class="btn"
                        onclick="document.getElementById('fileInput').click()"
                    >
                        Choose PDF File
                    </button>
                </div>
                <div id="uploadSection" class="upload-section">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text">
                            Drop your CEG file here or click to browse
                        </div>
                        <div class="upload-subtext">
                            Supports PDF files up to 10MB
                        </div>
                        <input type="file" id="cegInput" accept=".pdf" />
                        <button
                            class="btn"
                            onclick="document.getElementById('fileInput').click()"
                        >
                            Choose PDF File
                        </button>
                    </div>
            </div>

            <div id="processingSection" class="processing">
                <div class="spinner"></div>
                <h3>Scanning PDF Document...</h3>
                <p>Analyzing content, structure, and quality metrics</p>
            </div>

            <div id="reportSection" class="report-section">
                <div class="report-header">
                    <div id="gradeCircle" class="grade-circle">A+</div>
                    <h2 id="fileName">Document Analysis Report</h2>
                    <p id="scanDate">Scanned on: <span></span></p>
                </div>

                <div class="metrics">
                    <div class="metric-card">
                        <div class="metric-value" id="overallScore">92</div>
                        <div class="metric-label">Overall Score</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="pageCount">15</div>
                        <div class="metric-label">Pages Analyzed</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="readabilityScore">88</div>
                        <div class="metric-label">Readability Score</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="structureScore">95</div>
                        <div class="metric-label">Structure Score</div>
                    </div>
                </div>

                <div class="issues-section">
                    <h3>‚ö†Ô∏è Issues Found</h3>
                    <div id="issuesList"></div>
                </div>

                <div class="suggestions-section">
                    <h3>üí° Suggestions for Improvement</h3>
                    <div id="suggestionsList"></div>
                </div>

                <button class="btn reset-btn" onclick="resetScanner()">
                    Scan Another Document
                </button>
            </div>
            <button class="btn grade-btn" onclick="gradePorfolio()">Grade Portfolio</button>
        </div>

        <script>
            const uploadArea = document.getElementById("uploadArea");
            const fileInput = document.getElementById("fileInput");
            const cegInput = document.getElementById("cegInput");

            const uploadSection = document.getElementById("uploadSection");
            const processingSection =
                document.getElementById("processingSection");
            const reportSection = document.getElementById("reportSection");

            // Drag and drop functionality
            uploadArea.addEventListener("dragover", (e) => {
                e.preventDefault();
                uploadArea.classList.add("dragover");
            });

            uploadArea.addEventListener("dragleave", () => {
                uploadArea.classList.remove("dragover");
            });

            uploadArea.addEventListener("drop", (e) => {
                e.preventDefault();
                uploadArea.classList.remove("dragover");
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type === "application/pdf") {
                    handleFileUpload(files[0]);
                } else {
                    alert("Please upload a valid PDF file.");
                }
            });

            uploadArea.addEventListener("click", () => {
                fileInput.click();
            });

            fileInput.addEventListener("change", (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });

            function handleFileUpload(file) {
                if (file.size > 10 * 1024 * 1024) {
                    alert("File size must be less than 10MB");
                    return;
                }

                // Show processing screen
                uploadSection.style.display = "none";
                processingSection.style.display = "block";
            }

            function gradePorfolio(){
                const formData = new FormData();
                formData.append(
                    "portfolio",
                    fileInput.files[0]
                );
                formData.append(
                    "ceg",
                    cegInput.files[0]
                );
                fetch("/tools/process_portfolio/", {
                    method: "POST",
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: formData, // FormData automatically sets the Content-Type header to multipart/form-data
                })
                    .then((response) => {
                        if (!response.ok) {
                            throw new Error(
                                `HTTP error! status: ${response.status}`
                            );
                        }
                        return response.json(); // Or response.text() if your server doesn't return JSON
                    })
                    .then((data) => {
                        console.log("Upload successful:", data);
                    })
                    .catch((error) => {
                        console.error("Upload failed:", error);
                    });
            }

            /*
        function generateReport(file) {
            
            const overallScore = Math.floor(Math.random() * 30) + 70; // 70-100
            const pageCount = Math.floor(Math.random() * 50) + 5; // 5-55
            const readabilityScore = Math.floor(Math.random() * 40) + 60; // 60-100
            const structureScore = Math.floor(Math.random() * 35) + 65; // 65-100

            // Determine grade based on overall score
            let grade, gradeClass;
            if (overallScore >= 90) {
                grade = 'A+';
                gradeClass = 'grade-a';
            } else if (overallScore >= 80) {
                grade = 'B+';
                gradeClass = 'grade-b';
            } else if (overallScore >= 70) {
                grade = 'C+';
                gradeClass = 'grade-c';
            } else if (overallScore >= 60) {
                grade = 'D';
                gradeClass = 'grade-d';
            } else {
                grade = 'F';
                gradeClass = 'grade-f';
            }

            // Update report content
            document.getElementById('gradeCircle').textContent = grade;
            document.getElementById('gradeCircle').className = `grade-circle ${gradeClass}`;
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('scanDate').querySelector('span').textContent = new Date().toLocaleDateString();
            document.getElementById('overallScore').textContent = overallScore;
            document.getElementById('pageCount').textContent = pageCount;
            document.getElementById('readabilityScore').textContent = readabilityScore;
            document.getElementById('structureScore').textContent = structureScore;

            // Generate issues
            const possibleIssues = [
                {
                    title: 'Low Image Resolution',
                    description: 'Some images in the document have resolution below 300 DPI, which may affect print quality.'
                },
                {
                    title: 'Inconsistent Formatting',
                    description: 'Font sizes and styles vary inconsistently throughout the document.'
                },
                {
                    title: 'Missing Alt Text',
                    description: 'Images lack alternative text descriptions for accessibility.'
                },
                {
                    title: 'Large File Size',
                    description: 'Document size could be optimized for faster loading and sharing.'
                }
            ];

            const issuesList = document.getElementById('issuesList');
            issuesList.innerHTML = '';
            const numIssues = Math.floor(Math.random() * 3) + 1;
            const selectedIssues = possibleIssues.sort(() => 0.5 - Math.random()).slice(0, numIssues);

            selectedIssues.forEach(issue => {
                const issueDiv = document.createElement('div');
                issueDiv.className = 'issue-item';
                issueDiv.innerHTML = `
                    <div class="issue-title">${issue.title}</div>
                    <div class="issue-description">${issue.description}</div>
                `;
                issuesList.appendChild(issueDiv);
            });

            // Generate suggestions
            const possibleSuggestions = [
                {
                    title: 'Optimize Images',
                    description: 'Compress images to reduce file size while maintaining quality.'
                },
                {
                    title: 'Standardize Formatting',
                    description: 'Use consistent fonts, sizes, and spacing throughout the document.'
                },
                {
                    title: 'Add Table of Contents',
                    description: 'Include a navigable table of contents for better document structure.'
                },
                {
                    title: 'Improve Accessibility',
                    description: 'Add proper headings, alt text, and ensure good color contrast.'
                }
            ];

            const suggestionsList = document.getElementById('suggestionsList');
            suggestionsList.innerHTML = '';
            const numSuggestions = Math.floor(Math.random() * 3) + 2;
            const selectedSuggestions = possibleSuggestions.sort(() => 0.5 - Math.random()).slice(0, numSuggestions);

            selectedSuggestions.forEach(suggestion => {
                const suggestionDiv = document.createElement('div');
                suggestionDiv.className = 'suggestion-item';
                suggestionDiv.innerHTML = `
                    <div class="suggestion-title">${suggestion.title}</div>
                    <div class="suggestion-description">${suggestion.description}</div>
                `;
                suggestionsList.appendChild(suggestionDiv);
            });

            // Show report
            processingSection.style.display = 'none';
            reportSection.style.display = 'block';
        }
        */

            function resetScanner() {
                uploadSection.style.display = "block";
                processingSection.style.display = "none";
                reportSection.style.display = "none";
                fileInput.value = "";
            }
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        </script>
    </body>
</html>
